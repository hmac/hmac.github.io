<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../css/syntax.css" />
  </head>
  <body>
    <style>
      body {
        max-width: 600px;
        font-family: Palatino,Times New Roman,serif;
        margin: 0px auto 0px auto;
        font-size: 16px;
        line-height: 1.25;
      }
      pre {
        font-size: 14px;
      }
      ol#post-list {
        list-style-type: none
      }
      #header {
        border-bottom: 1px solid black;
        padding: 10px 0px 10px 0px;
      }
      #header #site {
        font-family: monospace;
        text-align: right
      }
      #header #name {
        float: left
      }
      #header a {
        text-decoration: none;
      }
      #header a:visited {
        color: black;
      }
      #header a:hover {
        color: black;
      }
    </style>
    <div id="header">
      <h2 id="name">Harry Maclean</h2>
      <h2 id="site"><a href="../">hmac.dev</a></h2>
    </div>
    <h1 id="implementing-a-functional-language-ii-graph-reduction">Implementing a Functional Language II: Graph Reduction</h1>
<p>This is part 2 of a series in implementing a functional language. The introduction is <a href="2019-03-02-implementing-a-functional-language.html">here</a>.</p>
<hr />
<p>Every compilation strategy we will cover in this series will be based on the same core concept: lazy graph reduction. This idea is simple but powerful, and it’s what we’ll introduce in this section.</p>
<p>A functional program is really just a single large expression which evaluates to a result. We can model it as a graph<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> of nested applications. For example, the expression <code>f 1 2</code> looks like this:</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="242pt" height="188pt" viewBox="0.00 0.00 242.00 188.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-184 238,-184 238,4 -4,4"></polygon>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="#000000" cx="162" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="162" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- b -->
<g id="node2" class="node">
<title>b</title>
<ellipse fill="none" stroke="#000000" cx="72" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="72" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;b -->
<g id="edge1" class="edge">
<title>a-&gt;b</title>
<path fill="none" stroke="#000000" d="M144.6471,-148.1177C131.2003,-137.3602 112.3761,-122.3009 97.259,-110.2072"></path>
<polygon fill="#000000" stroke="#000000" points="99.2948,-107.3536 89.2996,-103.8397 94.9219,-112.8197 99.2948,-107.3536"></polygon>
</g>
<!-- 2 -->
<g id="node3" class="node">
<title>2</title>
<ellipse fill="none" stroke="#000000" cx="207" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="207" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">2</text>
</g>
<!-- a&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>a-&gt;2</title>
<path fill="none" stroke="#000000" d="M172.437,-145.3008C177.9235,-136.5224 184.7686,-125.5703 190.9163,-115.7339"></path>
<polygon fill="#000000" stroke="#000000" points="193.9751,-117.4436 196.3071,-107.1086 188.0391,-113.7336 193.9751,-117.4436"></polygon>
</g>
<!-- f -->
<g id="node4" class="node">
<title>f</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">f</text>
</g>
<!-- b&#45;&gt;f -->
<g id="edge3" class="edge">
<title>b-&gt;f</title>
<path fill="none" stroke="#000000" d="M61.563,-73.3008C56.0765,-64.5224 49.2314,-53.5703 43.0837,-43.7339"></path>
<polygon fill="#000000" stroke="#000000" points="45.9609,-41.7336 37.6929,-35.1086 40.0249,-45.4436 45.9609,-41.7336"></polygon>
</g>
<!-- 1 -->
<g id="node5" class="node">
<title>1</title>
<ellipse fill="none" stroke="#000000" cx="117" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="117" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">1</text>
</g>
<!-- b&#45;&gt;1 -->
<g id="edge4" class="edge">
<title>b-&gt;1</title>
<path fill="none" stroke="#000000" d="M82.437,-73.3008C87.9235,-64.5224 94.7686,-53.5703 100.9163,-43.7339"></path>
<polygon fill="#000000" stroke="#000000" points="103.9751,-45.4436 106.3071,-35.1086 98.0391,-41.7336 103.9751,-45.4436"></polygon>
</g>
</g>
</svg>

<p>We use the symbol <code>@</code> to denote an application node. Note that though <code>f</code> takes two arguments, we apply each in turn via currying. Here’s a more complicated example - the graph of <code>(+ (* 2 3) 4)</code>:</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="422pt" height="332pt" viewBox="0.00 0.00 422.00 332.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-328 418,-328 418,4 -4,4"></polygon>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="#000000" cx="342" cy="-306" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="342" y="-301.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- b -->
<g id="node2" class="node">
<title>b</title>
<ellipse fill="none" stroke="#000000" cx="72" cy="-234" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="72" y="-229.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;b -->
<g id="edge1" class="edge">
<title>a-&gt;b</title>
<path fill="none" stroke="#000000" d="M316.5991,-299.2264C268.0309,-286.2749 161.9351,-257.9827 106.8111,-243.283"></path>
<polygon fill="#000000" stroke="#000000" points="107.7009,-239.898 97.1368,-240.7031 105.8973,-246.6617 107.7009,-239.898"></polygon>
</g>
<!-- 4 -->
<g id="node3" class="node">
<title>4</title>
<ellipse fill="none" stroke="#000000" cx="387" cy="-234" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="387" y="-229.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">4</text>
</g>
<!-- a&#45;&gt;4 -->
<g id="edge2" class="edge">
<title>a-&gt;4</title>
<path fill="none" stroke="#000000" d="M352.437,-289.3008C357.9235,-280.5224 364.7686,-269.5703 370.9163,-259.7339"></path>
<polygon fill="#000000" stroke="#000000" points="373.9751,-261.4436 376.3071,-251.1086 368.0391,-257.7336 373.9751,-261.4436"></polygon>
</g>
<!-- + -->
<g id="node4" class="node">
<title>+</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">+</text>
</g>
<!-- b&#45;&gt;+ -->
<g id="edge3" class="edge">
<title>b-&gt;+</title>
<path fill="none" stroke="#000000" d="M61.563,-217.3008C56.0765,-208.5224 49.2314,-197.5703 43.0837,-187.7339"></path>
<polygon fill="#000000" stroke="#000000" points="45.9609,-185.7336 37.6929,-179.1086 40.0249,-189.4436 45.9609,-185.7336"></polygon>
</g>
<!-- c -->
<g id="node5" class="node">
<title>c</title>
<ellipse fill="none" stroke="#000000" cx="252" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="252" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- b&#45;&gt;c -->
<g id="edge4" class="edge">
<title>b-&gt;c</title>
<path fill="none" stroke="#000000" d="M95.1634,-224.7347C126.6687,-212.1325 183.2073,-189.5171 219.1018,-175.1593"></path>
<polygon fill="#000000" stroke="#000000" points="220.6556,-178.3075 228.6404,-171.3438 218.0558,-171.8081 220.6556,-178.3075"></polygon>
</g>
<!-- d -->
<g id="node6" class="node">
<title>d</title>
<ellipse fill="none" stroke="#000000" cx="162" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="162" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- c&#45;&gt;d -->
<g id="edge5" class="edge">
<title>c-&gt;d</title>
<path fill="none" stroke="#000000" d="M234.6471,-148.1177C221.2003,-137.3602 202.3761,-122.3009 187.259,-110.2072"></path>
<polygon fill="#000000" stroke="#000000" points="189.2948,-107.3536 179.2996,-103.8397 184.9219,-112.8197 189.2948,-107.3536"></polygon>
</g>
<!-- 3 -->
<g id="node7" class="node">
<title>3</title>
<ellipse fill="none" stroke="#000000" cx="297" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="297" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">3</text>
</g>
<!-- c&#45;&gt;3 -->
<g id="edge6" class="edge">
<title>c-&gt;3</title>
<path fill="none" stroke="#000000" d="M262.437,-145.3008C267.9235,-136.5224 274.7686,-125.5703 280.9163,-115.7339"></path>
<polygon fill="#000000" stroke="#000000" points="283.9751,-117.4436 286.3071,-107.1086 278.0391,-113.7336 283.9751,-117.4436"></polygon>
</g>
<!-- * -->
<g id="node8" class="node">
<title>*</title>
<ellipse fill="none" stroke="#000000" cx="117" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="117" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">*</text>
</g>
<!-- d&#45;&gt;* -->
<g id="edge7" class="edge">
<title>d-&gt;*</title>
<path fill="none" stroke="#000000" d="M151.563,-73.3008C146.0765,-64.5224 139.2314,-53.5703 133.0837,-43.7339"></path>
<polygon fill="#000000" stroke="#000000" points="135.9609,-41.7336 127.6929,-35.1086 130.0249,-45.4436 135.9609,-41.7336"></polygon>
</g>
<!-- 2 -->
<g id="node9" class="node">
<title>2</title>
<ellipse fill="none" stroke="#000000" cx="207" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="207" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">2</text>
</g>
<!-- d&#45;&gt;2 -->
<g id="edge8" class="edge">
<title>d-&gt;2</title>
<path fill="none" stroke="#000000" d="M172.437,-73.3008C177.9235,-64.5224 184.7686,-53.5703 190.9163,-43.7339"></path>
<polygon fill="#000000" stroke="#000000" points="193.9751,-45.4436 196.3071,-35.1086 188.0391,-41.7336 193.9751,-45.4436"></polygon>
</g>
</g>
</svg>

<p>To evaluate the program, we’ll repeatedly <em>reduce</em> expressions in the graph. We’ll stop when there are no expressions left to reduce. The resulting graph is the result of the program. Reducing an expression typically involves applying a function to one or more arguments, producing a result, and then replacing the expression with the result.</p>
<p>Not all expressions can be reduced: <code>+ 1 2</code> reduces to <code>3</code> but <code>3</code> does not reduce any further. Similarly, <code>+ 1</code> does not reduce because <code>+</code> requires two arguments. An expression which is reducible is known as a reducible expression, or redex. To evaluate an entire program, all we need to do is repeatedly identify the next redex to reduce, and then reduce it, stopping when there are no redexes left.</p>
<p>Let’s try to reduce the graph above. We start at the top, with an application node <code>@</code>. The child nodes are <code>@</code> (another application) and <code>4</code>. We can’t immediately evaluate this expression, so we proceed down into the child application node, which itself has children <code>+</code> and <code>@</code>. <code>+</code> takes two arguments, in this case <code>(* 2 3)</code> and <code>4</code>. <code>+</code> also requires that both its arguments are evaluated, so we need to continue to reduce the first argument. We descend into the right hand application node - the root of <code>(* 2 3)</code>. Here’s where we are in the graph:</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="422pt" height="332pt" viewBox="0.00 0.00 422.00 332.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-328 418,-328 418,4 -4,4"></polygon>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="#000000" cx="342" cy="-306" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="342" y="-301.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- b -->
<g id="node2" class="node">
<title>b</title>
<ellipse fill="none" stroke="#000000" cx="72" cy="-234" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="72" y="-229.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;b -->
<g id="edge1" class="edge">
<title>a-&gt;b</title>
<path fill="none" stroke="#000000" d="M316.5991,-299.2264C268.0309,-286.2749 161.9351,-257.9827 106.8111,-243.283"></path>
<polygon fill="#000000" stroke="#000000" points="107.7009,-239.898 97.1368,-240.7031 105.8973,-246.6617 107.7009,-239.898"></polygon>
</g>
<!-- 4 -->
<g id="node3" class="node">
<title>4</title>
<ellipse fill="none" stroke="#000000" cx="387" cy="-234" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="387" y="-229.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">4</text>
</g>
<!-- a&#45;&gt;4 -->
<g id="edge2" class="edge">
<title>a-&gt;4</title>
<path fill="none" stroke="#000000" d="M352.437,-289.3008C357.9235,-280.5224 364.7686,-269.5703 370.9163,-259.7339"></path>
<polygon fill="#000000" stroke="#000000" points="373.9751,-261.4436 376.3071,-251.1086 368.0391,-257.7336 373.9751,-261.4436"></polygon>
</g>
<!-- + -->
<g id="node4" class="node">
<title>+</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">+</text>
</g>
<!-- b&#45;&gt;+ -->
<g id="edge3" class="edge">
<title>b-&gt;+</title>
<path fill="none" stroke="#000000" d="M61.563,-217.3008C56.0765,-208.5224 49.2314,-197.5703 43.0837,-187.7339"></path>
<polygon fill="#000000" stroke="#000000" points="45.9609,-185.7336 37.6929,-179.1086 40.0249,-189.4436 45.9609,-185.7336"></polygon>
</g>
<!-- c -->
<g id="node5" class="node">
<title>c</title>
<ellipse fill="none" stroke="#ff0000" cx="252" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="252" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- b&#45;&gt;c -->
<g id="edge4" class="edge">
<title>b-&gt;c</title>
<path fill="none" stroke="#000000" d="M95.1634,-224.7347C126.6687,-212.1325 183.2073,-189.5171 219.1018,-175.1593"></path>
<polygon fill="#000000" stroke="#000000" points="220.6556,-178.3075 228.6404,-171.3438 218.0558,-171.8081 220.6556,-178.3075"></polygon>
</g>
<!-- d -->
<g id="node6" class="node">
<title>d</title>
<ellipse fill="none" stroke="#000000" cx="162" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="162" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- c&#45;&gt;d -->
<g id="edge5" class="edge">
<title>c-&gt;d</title>
<path fill="none" stroke="#000000" d="M234.6471,-148.1177C221.2003,-137.3602 202.3761,-122.3009 187.259,-110.2072"></path>
<polygon fill="#000000" stroke="#000000" points="189.2948,-107.3536 179.2996,-103.8397 184.9219,-112.8197 189.2948,-107.3536"></polygon>
</g>
<!-- 3 -->
<g id="node7" class="node">
<title>3</title>
<ellipse fill="none" stroke="#000000" cx="297" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="297" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">3</text>
</g>
<!-- c&#45;&gt;3 -->
<g id="edge6" class="edge">
<title>c-&gt;3</title>
<path fill="none" stroke="#000000" d="M262.437,-145.3008C267.9235,-136.5224 274.7686,-125.5703 280.9163,-115.7339"></path>
<polygon fill="#000000" stroke="#000000" points="283.9751,-117.4436 286.3071,-107.1086 278.0391,-113.7336 283.9751,-117.4436"></polygon>
</g>
<!-- * -->
<g id="node8" class="node">
<title>*</title>
<ellipse fill="none" stroke="#000000" cx="117" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="117" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">*</text>
</g>
<!-- d&#45;&gt;* -->
<g id="edge7" class="edge">
<title>d-&gt;*</title>
<path fill="none" stroke="#000000" d="M151.563,-73.3008C146.0765,-64.5224 139.2314,-53.5703 133.0837,-43.7339"></path>
<polygon fill="#000000" stroke="#000000" points="135.9609,-41.7336 127.6929,-35.1086 130.0249,-45.4436 135.9609,-41.7336"></polygon>
</g>
<!-- 2 -->
<g id="node9" class="node">
<title>2</title>
<ellipse fill="none" stroke="#000000" cx="207" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="207" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">2</text>
</g>
<!-- d&#45;&gt;2 -->
<g id="edge8" class="edge">
<title>d-&gt;2</title>
<path fill="none" stroke="#000000" d="M172.437,-73.3008C177.9235,-64.5224 184.7686,-53.5703 190.9163,-43.7339"></path>
<polygon fill="#000000" stroke="#000000" points="193.9751,-45.4436 196.3071,-35.1086 188.0391,-41.7336 193.9751,-45.4436"></polygon>
</g>
</g>
</svg>

<p>As before, we descend into the child application node, finally reaching <code>*</code>. <code>*</code> takes two numeric arguments, and we have two arguments in <code>2</code> and <code>3</code>. We’ve found a reducible expression! Specifically, the subgraph</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="242pt" height="188pt" viewBox="0.00 0.00 242.00 188.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-184 238,-184 238,4 -4,4"></polygon>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="#ff0000" cx="162" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="162" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- b -->
<g id="node2" class="node">
<title>b</title>
<ellipse fill="none" stroke="#000000" cx="72" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="72" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;b -->
<g id="edge1" class="edge">
<title>a-&gt;b</title>
<path fill="none" stroke="#000000" d="M144.6471,-148.1177C131.2003,-137.3602 112.3761,-122.3009 97.259,-110.2072"></path>
<polygon fill="#000000" stroke="#000000" points="99.2948,-107.3536 89.2996,-103.8397 94.9219,-112.8197 99.2948,-107.3536"></polygon>
</g>
<!-- 3 -->
<g id="node3" class="node">
<title>3</title>
<ellipse fill="none" stroke="#000000" cx="207" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="207" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">3</text>
</g>
<!-- a&#45;&gt;3 -->
<g id="edge2" class="edge">
<title>a-&gt;3</title>
<path fill="none" stroke="#000000" d="M172.437,-145.3008C177.9235,-136.5224 184.7686,-125.5703 190.9163,-115.7339"></path>
<polygon fill="#000000" stroke="#000000" points="193.9751,-117.4436 196.3071,-107.1086 188.0391,-113.7336 193.9751,-117.4436"></polygon>
</g>
<!-- * -->
<g id="node4" class="node">
<title>*</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">*</text>
</g>
<!-- b&#45;&gt;* -->
<g id="edge3" class="edge">
<title>b-&gt;*</title>
<path fill="none" stroke="#000000" d="M61.563,-73.3008C56.0765,-64.5224 49.2314,-53.5703 43.0837,-43.7339"></path>
<polygon fill="#000000" stroke="#000000" points="45.9609,-41.7336 37.6929,-35.1086 40.0249,-45.4436 45.9609,-41.7336"></polygon>
</g>
<!-- 2 -->
<g id="node5" class="node">
<title>2</title>
<ellipse fill="none" stroke="#000000" cx="117" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="117" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">2</text>
</g>
<!-- b&#45;&gt;2 -->
<g id="edge4" class="edge">
<title>b-&gt;2</title>
<path fill="none" stroke="#000000" d="M82.437,-73.3008C87.9235,-64.5224 94.7686,-53.5703 100.9163,-43.7339"></path>
<polygon fill="#000000" stroke="#000000" points="103.9751,-45.4436 106.3071,-35.1086 98.0391,-41.7336 103.9751,-45.4436"></polygon>
</g>
</g>
</svg>

<p>can be reduced to the single numeric node <code>6</code>. The node marked in red is the <em>root</em> of the redex. Performing the reduction, the graph now looks like this:</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="242pt" height="188pt" viewBox="0.00 0.00 242.00 188.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-184 238,-184 238,4 -4,4"></polygon>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="#000000" cx="162" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="162" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- b -->
<g id="node2" class="node">
<title>b</title>
<ellipse fill="none" stroke="#000000" cx="72" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="72" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;b -->
<g id="edge1" class="edge">
<title>a-&gt;b</title>
<path fill="none" stroke="#000000" d="M144.6471,-148.1177C131.2003,-137.3602 112.3761,-122.3009 97.259,-110.2072"></path>
<polygon fill="#000000" stroke="#000000" points="99.2948,-107.3536 89.2996,-103.8397 94.9219,-112.8197 99.2948,-107.3536"></polygon>
</g>
<!-- 4 -->
<g id="node3" class="node">
<title>4</title>
<ellipse fill="none" stroke="#000000" cx="207" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="207" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">4</text>
</g>
<!-- a&#45;&gt;4 -->
<g id="edge2" class="edge">
<title>a-&gt;4</title>
<path fill="none" stroke="#000000" d="M172.437,-145.3008C177.9235,-136.5224 184.7686,-125.5703 190.9163,-115.7339"></path>
<polygon fill="#000000" stroke="#000000" points="193.9751,-117.4436 196.3071,-107.1086 188.0391,-113.7336 193.9751,-117.4436"></polygon>
</g>
<!-- + -->
<g id="node4" class="node">
<title>+</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">+</text>
</g>
<!-- b&#45;&gt;+ -->
<g id="edge3" class="edge">
<title>b-&gt;+</title>
<path fill="none" stroke="#000000" d="M61.563,-73.3008C56.0765,-64.5224 49.2314,-53.5703 43.0837,-43.7339"></path>
<polygon fill="#000000" stroke="#000000" points="45.9609,-41.7336 37.6929,-35.1086 40.0249,-45.4436 45.9609,-41.7336"></polygon>
</g>
<!-- c -->
<g id="node5" class="node">
<title>c</title>
<ellipse fill="none" stroke="#ff0000" cx="117" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="117" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">6</text>
</g>
<!-- b&#45;&gt;c -->
<g id="edge4" class="edge">
<title>b-&gt;c</title>
<path fill="none" stroke="#000000" d="M82.437,-73.3008C87.9235,-64.5224 94.7686,-53.5703 100.9163,-43.7339"></path>
<polygon fill="#000000" stroke="#000000" points="103.9751,-45.4436 106.3071,-35.1086 98.0391,-41.7336 103.9751,-45.4436"></polygon>
</g>
</g>
</svg>

<p>Notice that the expression <code>(* 2 3)</code> has been replaced with the result of its reduction (<code>6</code>). Proceeding back up graph, we can see that the arguments to <code>+</code> are now both evaluated, so we’ve found another redex. Reducing this, we end up with a single node <code>10</code>, which is the result of the whole expression.</p>
<h2 id="reduction-order">Reduction order</h2>
<p>The order in which we reduce expressions in a program has a profound effect on the behaviour of the program. The approach we used in reducing the program above is called <em>normal order reduction</em>. Normal order reduction requires that we reduce the leftmost outermost redex first.</p>
<p>One consequence of this is that we reduce applications before reducing their arguments. This is in contrast to a typical imperative language, where arguments to functions are evaluated before the function is called. Take for example the following Core program:</p>
<pre><code>K x y = x
main = K 1 (/ 1 0)</code></pre>
<p>where we can assume that <code>(/ 1 0)</code> will raise an error if evaluated. Following normal order reduction, we will reduce the application of <code>K</code> first, resulting in the following:</p>
<pre><code>main = 1</code></pre>
<p>Since the second argument to <code>K</code> is never used, we never evaluate it. In a typical imperative language, we would evaluate <code>(/ 1 0)</code> first, resulting in an error. This style of execution is called <em>lazy evaluation</em>, in contrast to <em>strict evaluation</em>. The two key properties of lazy evaluation are the following:</p>
<ul>
<li>Arguments to functions are only evaluated when needed.</li>
<li>Each argument is only evaluated once - further uses of the argument will use the result from the initial evaluation.</li>
</ul>
<p>The second property doesn’t affect program behaviour but greatly improves efficiency.</p>
<h2 id="normal-form-and-weak-head-normal-form">Normal form and Weak head normal form</h2>
<p>Normal order reduction specifies that we reduce the leftmost outermost redex first, but it doesn’t specify when to <em>stop</em>. A natural assumption is to stop when there are no redexes left, but this is not our only option. If the output of our program is being printed to the screen, and we want to show progress as we go (or we’re printing an infinite stream of values) then we want to be able to produce output without having fulling evaluated it yet. Imagine a list made from a series of <code>Cons</code> cells linked together: we may want to print the first element before having evaluated the whole list.</p>
<p>To do this, we need to stop reducing when there is no longer a <em>top-level</em> redex. This will allow us to inspect the structure and decide what to evaluate next. An expression which has no top-level redexes (but may have inner redexes left) is in <em>weak head normal form</em> (WHNF). An expression which has no redexes at all is in <em>normal form</em> (NF). All expressions in NF are also in WHNF, but not vice versa. Here are some examples.</p>
<table>
<thead>
<tr class="header">
<th>Normal Form</th>
<th>Weak Head Normal Form</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>3</code></td>
<td><code>3</code></td>
</tr>
<tr class="even">
<td><code>(+ 1)</code></td>
<td><code>(+ 1)</code></td>
</tr>
<tr class="odd">
<td></td>
<td><code>(+ (+ 2 3))</code></td>
</tr>
</tbody>
</table>
<p>For Core we’ll follow lazy evaluation and evaluate expressions to WHNF. For some built in functions (like <code>+</code>) we will adopt strict semantics, requiring arguments to be fully evaluated to normal form. For all user-defined functions we’ll use lazy semantics.</p>
<h2 id="reducing-programs">Reducing programs</h2>
<p>Let’s walk through the evaluation of the following program:</p>
<pre><code>square x = * x x ;
main = square (square 3)</code></pre>
<p>To start with, the graph of our program consists of just the node <code>main</code>. For reference we’ve also drawn the graph of the supercombinator <code>square</code>, though we don’t evaluate this until it appears in <code>main</code>.</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="71pt" height="44pt" viewBox="0.00 0.00 71.00 44.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 40)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-40 67,-40 67,4 -4,4"></polygon>
<!-- main -->
<g id="node1" class="node">
<title>main</title>
<ellipse fill="none" stroke="#000000" cx="31.5" cy="-18" rx="31.5" ry="18"></ellipse>
<text text-anchor="middle" x="31.5" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">main</text>
</g>
</g>
</svg>

<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="134pt" height="210pt" viewBox="0.00 0.00 134.00 210.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 206)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-206 130,-206 130,4 -4,4"></polygon>
<text text-anchor="middle" x="63" y="-6.8" font-family="Times,serif" font-size="14.00" fill="#000000">square</text>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="#000000" cx="71" cy="-184" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="71" y="-179.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- b -->
<g id="node2" class="node">
<title>b</title>
<ellipse fill="none" stroke="#000000" cx="44" cy="-112" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="44" y="-107.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;b -->
<g id="edge1" class="edge">
<title>a-&gt;b</title>
<path fill="none" stroke="#000000" d="M64.3258,-166.2022C61.2524,-158.0064 57.5384,-148.1024 54.1305,-139.0145"></path>
<polygon fill="#000000" stroke="#000000" points="57.3858,-137.7274 50.5974,-129.593 50.8315,-140.1853 57.3858,-137.7274"></polygon>
</g>
<!-- x -->
<g id="node4" class="node">
<title>x</title>
<ellipse fill="none" stroke="#000000" cx="99" cy="-40" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-35.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">x</text>
</g>
<!-- a&#45;&gt;x -->
<g id="edge3" class="edge">
<title>a-&gt;x</title>
<path fill="none" stroke="#000000" d="M74.4896,-166.0535C79.2683,-141.4774 87.8971,-97.1008 93.5366,-68.0974"></path>
<polygon fill="#000000" stroke="#000000" points="96.9933,-68.6569 95.4664,-58.1727 90.122,-67.3208 96.9933,-68.6569"></polygon>
</g>
<!-- * -->
<g id="node3" class="node">
<title>*</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-40" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-35.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">*</text>
</g>
<!-- b&#45;&gt;* -->
<g id="edge2" class="edge">
<title>b-&gt;*</title>
<path fill="none" stroke="#000000" d="M39.7978,-94.2022C37.9179,-86.2406 35.6575,-76.6671 33.5629,-67.7957"></path>
<polygon fill="#000000" stroke="#000000" points="36.9172,-66.7706 31.2128,-57.8425 30.1045,-68.3792 36.9172,-66.7706"></polygon>
</g>
<!-- b&#45;&gt;x -->
<g id="edge4" class="edge">
<title>b-&gt;x</title>
<path fill="none" stroke="#000000" d="M56.4804,-95.6621C63.5124,-86.4564 72.4347,-74.7764 80.2883,-64.4953"></path>
<polygon fill="#000000" stroke="#000000" points="83.28,-66.3446 86.569,-56.2733 77.7172,-62.0953 83.28,-66.3446"></polygon>
</g>
</g>
</svg>

<p><code>main</code> is a supercombinator with no arguments, so it is a redex. We reduce it by replacing it with its body, yielding the following graph:</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="302pt" height="188pt" viewBox="0.00 0.00 301.84 188.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-184 297.8416,-184 297.8416,4 -4,4"></polygon>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="#ff0000" cx="101.9472" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="101.9472" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- square1 -->
<g id="node2" class="node">
<title>square1</title>
<ellipse fill="none" stroke="#000000" cx="42" cy="-90" rx="42" ry="18"></ellipse>
<text text-anchor="middle" x="42" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">square</text>
</g>
<!-- a&#45;&gt;square1 -->
<g id="edge1" class="edge">
<title>a-&gt;square1</title>
<path fill="none" stroke="#000000" d="M88.643,-146.0209C81.0764,-136.933 71.4317,-125.3492 62.8785,-115.0763"></path>
<polygon fill="#000000" stroke="#000000" points="65.4019,-112.637 56.3136,-107.1915 60.0224,-117.116 65.4019,-112.637"></polygon>
</g>
<!-- b -->
<g id="node3" class="node">
<title>b</title>
<ellipse fill="none" stroke="#000000" cx="221.8416" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="221.8416" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;b -->
<g id="edge2" class="edge">
<title>a-&gt;b</title>
<path fill="none" stroke="#000000" d="M122.0148,-149.9488C141.4666,-138.2675 171.1708,-120.4293 193.1233,-107.2461"></path>
<polygon fill="#000000" stroke="#000000" points="194.9375,-110.2394 201.7085,-102.0905 191.3336,-104.2383 194.9375,-110.2394"></polygon>
</g>
<!-- square2 -->
<g id="node4" class="node">
<title>square2</title>
<ellipse fill="none" stroke="#000000" cx="161.8944" cy="-18" rx="42" ry="18"></ellipse>
<text text-anchor="middle" x="161.8944" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">square</text>
</g>
<!-- b&#45;&gt;square2 -->
<g id="edge3" class="edge">
<title>b-&gt;square2</title>
<path fill="none" stroke="#000000" d="M208.5374,-74.0209C200.9708,-64.933 191.3261,-53.3492 182.7729,-43.0763"></path>
<polygon fill="#000000" stroke="#000000" points="185.2963,-40.637 176.208,-35.1915 179.9168,-45.116 185.2963,-40.637"></polygon>
</g>
<!-- 3 -->
<g id="node5" class="node">
<title>3</title>
<ellipse fill="none" stroke="#000000" cx="266.8416" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="266.8416" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">3</text>
</g>
<!-- b&#45;&gt;3 -->
<g id="edge4" class="edge">
<title>b-&gt;3</title>
<path fill="none" stroke="#000000" d="M232.2786,-73.3008C237.7651,-64.5224 244.6102,-53.5703 250.7579,-43.7339"></path>
<polygon fill="#000000" stroke="#000000" points="253.8167,-45.4436 256.1487,-35.1086 247.8807,-41.7336 253.8167,-45.4436"></polygon>
</g>
</g>
</svg>

<p>The outermost redex is the top node - the outer application of <code>square</code>. To reduce it, we replace the redex with an instance of the supercombinator body, substituting any parameters with a pointer to the argument of the application. This gives us:</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="178pt" height="260pt" viewBox="0.00 0.00 178.00 260.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 256)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-256 174,-256 174,4 -4,4"></polygon>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="#0000ff" cx="71" cy="-234" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="71" y="-229.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- b -->
<g id="node2" class="node">
<title>b</title>
<ellipse fill="none" stroke="#0000ff" cx="44" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="44" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;b -->
<g id="edge1" class="edge">
<title>a-&gt;b</title>
<path fill="none" stroke="#0000ff" d="M64.3258,-216.2022C61.2524,-208.0064 57.5384,-198.1024 54.1305,-189.0145"></path>
<polygon fill="#0000ff" stroke="#0000ff" points="57.3858,-187.7274 50.5974,-179.593 50.8315,-190.1853 57.3858,-187.7274"></polygon>
</g>
<!-- c -->
<g id="node4" class="node">
<title>c</title>
<ellipse fill="none" stroke="#000000" cx="99" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;c -->
<g id="edge4" class="edge">
<title>a-&gt;c</title>
<path fill="none" stroke="#0000ff" d="M74.4896,-216.0535C79.2683,-191.4774 87.8971,-147.1008 93.5366,-118.0974"></path>
<polygon fill="#0000ff" stroke="#0000ff" points="96.9933,-118.6569 95.4664,-108.1727 90.122,-117.3208 96.9933,-118.6569"></polygon>
</g>
<!-- star -->
<g id="node3" class="node">
<title>star</title>
<ellipse fill="none" stroke="#0000ff" cx="27" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">*</text>
</g>
<!-- b&#45;&gt;star -->
<g id="edge2" class="edge">
<title>b-&gt;star</title>
<path fill="none" stroke="#0000ff" d="M39.7978,-144.2022C37.9179,-136.2406 35.6575,-126.6671 33.5629,-117.7957"></path>
<polygon fill="#0000ff" stroke="#0000ff" points="36.9172,-116.7706 31.2128,-107.8425 30.1045,-118.3792 36.9172,-116.7706"></polygon>
</g>
<!-- b&#45;&gt;c -->
<g id="edge3" class="edge">
<title>b-&gt;c</title>
<path fill="none" stroke="#0000ff" d="M56.4804,-145.6621C63.5124,-136.4564 72.4347,-124.7764 80.2883,-114.4953"></path>
<polygon fill="#0000ff" stroke="#0000ff" points="83.28,-116.3446 86.569,-106.2733 77.7172,-112.0953 83.28,-116.3446"></polygon>
</g>
<!-- square -->
<g id="node5" class="node">
<title>square</title>
<ellipse fill="none" stroke="#000000" cx="56" cy="-18" rx="41.897" ry="18"></ellipse>
<text text-anchor="middle" x="56" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">square</text>
</g>
<!-- c&#45;&gt;square -->
<g id="edge5" class="edge">
<title>c-&gt;square</title>
<path fill="none" stroke="#000000" d="M88.8096,-72.937C83.6904,-64.3654 77.3754,-53.7914 71.6571,-44.2165"></path>
<polygon fill="#000000" stroke="#000000" points="74.5483,-42.2315 66.416,-35.4407 68.5385,-45.8207 74.5483,-42.2315"></polygon>
</g>
<!-- 3 -->
<g id="node6" class="node">
<title>3</title>
<ellipse fill="none" stroke="#000000" cx="143" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="143" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">3</text>
</g>
<!-- c&#45;&gt;3 -->
<g id="edge6" class="edge">
<title>c-&gt;3</title>
<path fill="none" stroke="#000000" d="M109.2051,-73.3008C114.5696,-64.5224 121.2626,-53.5703 127.2737,-43.7339"></path>
<polygon fill="#000000" stroke="#000000" points="130.3167,-45.4666 132.5447,-35.1086 124.3437,-41.8164 130.3167,-45.4666"></polygon>
</g>
</g>
</svg>

<p>We see that the inner redex <code>(square 3)</code> is now shared between two application nodes. Notice that this transformation has resulted in a true <em>graph</em> rather than a tree. The subgraph coloured blue is the instantiated body of <code>square</code>.</p>
<p>The application of <code>*</code> cannot be reduced because <code>*</code> is a strict primitive and requires both its arguments to be evaluated first. Hence the only redex is the inner <code>(square 3)</code>. This yields:</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="160pt" height="332pt" viewBox="0.00 0.00 160.00 332.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-328 156,-328 156,4 -4,4"></polygon>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="#000000" cx="108" cy="-306" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="108" y="-301.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- b -->
<g id="node2" class="node">
<title>b</title>
<ellipse fill="none" stroke="#000000" cx="53" cy="-234" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="53" y="-229.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;b -->
<g id="edge1" class="edge">
<title>a-&gt;b</title>
<path fill="none" stroke="#000000" d="M95.5196,-289.6621C88.4876,-280.4564 79.5653,-268.7764 71.7117,-258.4953"></path>
<polygon fill="#000000" stroke="#000000" points="74.2828,-256.0953 65.431,-250.2733 68.72,-260.3446 74.2828,-256.0953"></polygon>
</g>
<!-- 3 -->
<g id="node3" class="node">
<title>3</title>
<ellipse fill="none" stroke="#0000ff" cx="125" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="125" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">3</text>
</g>
<!-- a&#45;&gt;3 -->
<!-- c -->
<g id="node5" class="node">
<title>c</title>
<ellipse fill="none" stroke="#0000ff" cx="99" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;c -->
<g id="edge4" class="edge">
<title>a-&gt;c</title>
<path fill="none" stroke="#000000" d="M106.8601,-287.7623C105.3251,-263.201 102.578,-219.2474 100.7721,-190.3541"></path>
<polygon fill="#000000" stroke="#000000" points="104.2477,-189.8518 100.1306,-180.0896 97.2613,-190.2885 104.2477,-189.8518"></polygon>
</g>
<!-- star1 -->
<g id="node4" class="node">
<title>star1</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">*</text>
</g>
<!-- b&#45;&gt;star1 -->
<g id="edge2" class="edge">
<title>b-&gt;star1</title>
<path fill="none" stroke="#000000" d="M46.573,-216.2022C43.6134,-208.0064 40.037,-198.1024 36.7553,-189.0145"></path>
<polygon fill="#000000" stroke="#000000" points="40.0415,-187.8098 33.353,-179.593 33.4576,-190.1874 40.0415,-187.8098"></polygon>
</g>
<!-- b&#45;&gt;c -->
<g id="edge3" class="edge">
<title>b-&gt;c</title>
<path fill="none" stroke="#000000" d="M63.6689,-217.3008C69.3586,-208.3952 76.4777,-197.2524 82.8316,-187.307"></path>
<polygon fill="#000000" stroke="#000000" points="85.9544,-188.92 88.3889,-178.6087 80.0555,-185.1513 85.9544,-188.92"></polygon>
</g>
<!-- c&#45;&gt;3 -->
<g id="edge7" class="edge">
<title>c-&gt;3</title>
<path fill="none" stroke="#0000ff" d="M102.2403,-144.0535C106.6777,-119.4774 114.6901,-75.1008 119.9269,-46.0974"></path>
<polygon fill="#0000ff" stroke="#0000ff" points="123.3862,-46.6355 121.7188,-36.1727 116.4976,-45.3917 123.3862,-46.6355"></polygon>
</g>
<!-- d -->
<g id="node6" class="node">
<title>d</title>
<ellipse fill="none" stroke="#0000ff" cx="61" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="61" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- c&#45;&gt;d -->
<g id="edge5" class="edge">
<title>c-&gt;d</title>
<path fill="none" stroke="#0000ff" d="M89.9945,-144.937C85.5172,-136.4537 80.0048,-126.0092 74.993,-116.513"></path>
<polygon fill="#0000ff" stroke="#0000ff" points="77.9678,-114.6509 70.2048,-107.4407 71.7771,-117.9182 77.9678,-114.6509"></polygon>
</g>
<!-- d&#45;&gt;3 -->
<g id="edge8" class="edge">
<title>d-&gt;3</title>
<path fill="none" stroke="#0000ff" d="M74.887,-74.3771C83.5253,-64.659 94.7893,-51.987 104.4497,-41.1191"></path>
<polygon fill="#0000ff" stroke="#0000ff" points="107.1123,-43.3918 111.1401,-33.5924 101.8804,-38.7413 107.1123,-43.3918"></polygon>
</g>
<!-- star2 -->
<g id="node7" class="node">
<title>star2</title>
<ellipse fill="none" stroke="#0000ff" cx="53" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="53" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">*</text>
</g>
<!-- d&#45;&gt;star2 -->
<g id="edge6" class="edge">
<title>d-&gt;star2</title>
<path fill="none" stroke="#0000ff" d="M58.9813,-71.8314C58.1257,-64.131 57.1083,-54.9743 56.1574,-46.4166"></path>
<polygon fill="#0000ff" stroke="#0000ff" points="59.6289,-45.9656 55.0459,-36.4133 52.6717,-46.7386 59.6289,-45.9656"></polygon>
</g>
</g>
</svg>

<p>The subgraph coloured blue is the second instantiation of <code>square</code>. The only redex is now the inner multiplication, so we reduce that.</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="134pt" height="188pt" viewBox="0.00 0.00 134.00 188.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-184 130,-184 130,4 -4,4"></polygon>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="#000000" cx="71" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="71" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- b -->
<g id="node2" class="node">
<title>b</title>
<ellipse fill="none" stroke="#000000" cx="44" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="44" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;b -->
<g id="edge1" class="edge">
<title>a-&gt;b</title>
<path fill="none" stroke="#000000" d="M64.3258,-144.2022C61.2524,-136.0064 57.5384,-126.1024 54.1305,-117.0145"></path>
<polygon fill="#000000" stroke="#000000" points="57.3858,-115.7274 50.5974,-107.593 50.8315,-118.1853 57.3858,-115.7274"></polygon>
</g>
<!-- nine -->
<g id="node4" class="node">
<title>nine</title>
<ellipse fill="none" stroke="#000000" cx="99" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">9</text>
</g>
<!-- a&#45;&gt;nine -->
<g id="edge3" class="edge">
<title>a-&gt;nine</title>
<path fill="none" stroke="#000000" d="M74.4896,-144.0535C79.2683,-119.4774 87.8971,-75.1008 93.5366,-46.0974"></path>
<polygon fill="#000000" stroke="#000000" points="96.9933,-46.6569 95.4664,-36.1727 90.122,-45.3208 96.9933,-46.6569"></polygon>
</g>
<!-- * -->
<g id="node3" class="node">
<title>*</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">*</text>
</g>
<!-- b&#45;&gt;* -->
<g id="edge2" class="edge">
<title>b-&gt;*</title>
<path fill="none" stroke="#000000" d="M39.7978,-72.2022C37.9179,-64.2406 35.6575,-54.6671 33.5629,-45.7957"></path>
<polygon fill="#000000" stroke="#000000" points="36.9172,-44.7706 31.2128,-35.8425 30.1045,-46.3792 36.9172,-44.7706"></polygon>
</g>
<!-- b&#45;&gt;nine -->
<g id="edge4" class="edge">
<title>b-&gt;nine</title>
<path fill="none" stroke="#000000" d="M56.4804,-73.6621C63.5124,-64.4564 72.4347,-52.7764 80.2883,-42.4953"></path>
<polygon fill="#000000" stroke="#000000" points="83.28,-44.3446 86.569,-34.2733 77.7172,-40.0953 83.28,-44.3446"></polygon>
</g>
</g>
</svg>

<p>And now we can reduce the outer multiplication, which directly yields <code>81</code>.</p>
<p>So the general steps are:</p>
<ol type="1">
<li>Find the next redex</li>
<li>Reduce it</li>
<li>Update the root of the redex with the result</li>
</ol>
<h2 id="unwinding-the-spine">Unwinding the spine</h2>
<p>To find the next redex, we need to find the leftmost outermost function application. To do that we follow these steps:</p>
<ol type="1">
<li>From the root of the graph, follow the left branch until you reach a supercombinator or primitive.</li>
<li>Check how many arguments the supercombinator or primitive takes and go back up the graph that number of times - you’re now at the root of the outermost function application.</li>
</ol>
<p>The chain of left-branching application nodes is called the <em>spine</em>, and the process of traversing it like this is called known as <em>unwinding</em> the spine. The function arguments are typically stored on a stack to make them easy to access.</p>
<p>If the function is a supercombinator, then we’ve found a redex. If it’s a primitive, then we may first need to reduce the arguments to the function before the application becomes reducible.</p>
<p>If we need to reduce an argument, we must put the current stack to one side and begin unwinding again from the root of the argument. We may need to repeat this if the argument contains further unevaluated function applications. To keep track of these stacks we use a stack of stacks, known as a <em>dump</em>. When we need to evaluate an argument we push the current stack on to the dump, and when we’ve finished evaluating it we pop the old stack off the dump.</p>
<h2 id="reducing-letrec-expressions">Reducing <code>let(rec)</code> expressions</h2>
<p>A supercombinator is reduced by substituting arguments into its body. If there are <code>let(rec)</code> expressions in the body, they are represented as paths in the graph. For example:</p>
<pre><code>let y = 3
 in + y y</code></pre>
<p>is represented as</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="134pt" height="188pt" viewBox="0.00 0.00 134.00 188.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-184 130,-184 130,4 -4,4"></polygon>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="#000000" cx="71" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="71" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- b -->
<g id="node2" class="node">
<title>b</title>
<ellipse fill="none" stroke="#000000" cx="44" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="44" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;b -->
<g id="edge1" class="edge">
<title>a-&gt;b</title>
<path fill="none" stroke="#000000" d="M64.3258,-144.2022C61.2524,-136.0064 57.5384,-126.1024 54.1305,-117.0145"></path>
<polygon fill="#000000" stroke="#000000" points="57.3858,-115.7274 50.5974,-107.593 50.8315,-118.1853 57.3858,-115.7274"></polygon>
</g>
<!-- 3 -->
<g id="node4" class="node">
<title>3</title>
<ellipse fill="none" stroke="#000000" cx="99" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">3</text>
</g>
<!-- a&#45;&gt;3 -->
<g id="edge4" class="edge">
<title>a-&gt;3</title>
<path fill="none" stroke="#000000" d="M74.4896,-144.0535C79.2683,-119.4774 87.8971,-75.1008 93.5366,-46.0974"></path>
<polygon fill="#000000" stroke="#000000" points="96.9933,-46.6569 95.4664,-36.1727 90.122,-45.3208 96.9933,-46.6569"></polygon>
</g>
<!-- + -->
<g id="node3" class="node">
<title>+</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">+</text>
</g>
<!-- b&#45;&gt;+ -->
<g id="edge2" class="edge">
<title>b-&gt;+</title>
<path fill="none" stroke="#000000" d="M39.7978,-72.2022C37.9179,-64.2406 35.6575,-54.6671 33.5629,-45.7957"></path>
<polygon fill="#000000" stroke="#000000" points="36.9172,-44.7706 31.2128,-35.8425 30.1045,-46.3792 36.9172,-44.7706"></polygon>
</g>
<!-- b&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>b-&gt;3</title>
<path fill="none" stroke="#000000" d="M56.4804,-73.6621C63.5124,-64.4564 72.4347,-52.7764 80.2883,-42.4953"></path>
<polygon fill="#000000" stroke="#000000" points="83.28,-44.3446 86.569,-34.2733 77.7172,-40.0953 83.28,-44.3446"></polygon>
</g>
</g>
</svg>

<p>The <code>let</code> expression defines a sub-expression <code>3</code>, which is named <code>y</code>. The body of the <code>let</code> expression references <code>y</code> via pointers to <code>3</code>. In this way, the single instance of <code>y</code> is shared between the two arguments to <code>+</code>.</p>
<p>Let’s look at a more complex example: the reduction of a supercombinator application.</p>
<pre><code>f x = let y = * x x
       in + y y
main = f 3</code></pre>
<p>We start with the <code>main</code> supercombinator:</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="71pt" height="44pt" viewBox="0.00 0.00 70.67 44.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 40)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-40 66.6692,-40 66.6692,4 -4,4"></polygon>
<!-- main -->
<g id="node1" class="node">
<title>main</title>
<ellipse fill="none" stroke="#000000" cx="31.3346" cy="-18" rx="31.1701" ry="18"></ellipse>
<text text-anchor="middle" x="31.3346" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">main</text>
</g>
</g>
</svg>

<p>which reduces to</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="134pt" height="116pt" viewBox="0.00 0.00 134.00 116.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 112)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-112 130,-112 130,4 -4,4"></polygon>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="#000000" cx="63" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="63" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- f -->
<g id="node2" class="node">
<title>f</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">f</text>
</g>
<!-- a&#45;&gt;f -->
<g id="edge1" class="edge">
<title>a-&gt;f</title>
<path fill="none" stroke="#000000" d="M54.2854,-72.5708C50.0403,-64.0807 44.8464,-53.6929 40.1337,-44.2674"></path>
<polygon fill="#000000" stroke="#000000" points="43.237,-42.6477 35.6343,-35.2687 36.976,-45.7782 43.237,-42.6477"></polygon>
</g>
<!-- 3 -->
<g id="node3" class="node">
<title>3</title>
<ellipse fill="none" stroke="#000000" cx="99" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">3</text>
</g>
<!-- a&#45;&gt;3 -->
<g id="edge2" class="edge">
<title>a-&gt;3</title>
<path fill="none" stroke="#000000" d="M71.7146,-72.5708C75.9597,-64.0807 81.1536,-53.6929 85.8663,-44.2674"></path>
<polygon fill="#000000" stroke="#000000" points="89.024,-45.7782 90.3657,-35.2687 82.763,-42.6477 89.024,-45.7782"></polygon>
</g>
</g>
</svg>

<p>which reduces to</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="172pt" height="332pt" viewBox="0.00 0.00 172.00 332.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-328 168,-328 168,4 -4,4"></polygon>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="#000000" cx="81" cy="-306" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="81" y="-301.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- b -->
<g id="node2" class="node">
<title>b</title>
<ellipse fill="none" stroke="#000000" cx="54" cy="-234" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="54" y="-229.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;b -->
<g id="edge1" class="edge">
<title>a-&gt;b</title>
<path fill="none" stroke="#000000" d="M74.3258,-288.2022C71.2524,-280.0064 67.5384,-270.1024 64.1305,-261.0145"></path>
<polygon fill="#000000" stroke="#000000" points="67.3858,-259.7274 60.5974,-251.593 60.8315,-262.1853 67.3858,-259.7274"></polygon>
</g>
<!-- c -->
<g id="node4" class="node">
<title>c</title>
<ellipse fill="none" stroke="#000000" cx="109" cy="-162" rx="36.7836" ry="18"></ellipse>
<text text-anchor="middle" x="109" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@ (y)</text>
</g>
<!-- a&#45;&gt;c -->
<g id="edge3" class="edge">
<title>a-&gt;c</title>
<path fill="none" stroke="#000000" d="M84.4896,-288.0535C89.2683,-263.4774 97.8971,-219.1008 103.5366,-190.0974"></path>
<polygon fill="#000000" stroke="#000000" points="106.9933,-190.6569 105.4664,-180.1727 100.122,-189.3208 106.9933,-190.6569"></polygon>
</g>
<!-- + -->
<g id="node3" class="node">
<title>+</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">+</text>
</g>
<!-- b&#45;&gt;+ -->
<g id="edge2" class="edge">
<title>b-&gt;+</title>
<path fill="none" stroke="#000000" d="M47.3258,-216.2022C44.2524,-208.0064 40.5384,-198.1024 37.1305,-189.0145"></path>
<polygon fill="#000000" stroke="#000000" points="40.3858,-187.7274 33.5974,-179.593 33.8315,-190.1853 40.3858,-187.7274"></polygon>
</g>
<!-- b&#45;&gt;c -->
<g id="edge4" class="edge">
<title>b-&gt;c</title>
<path fill="none" stroke="#000000" d="M66.4804,-217.6621C73.3639,-208.6509 82.0585,-197.2688 89.7891,-187.1488"></path>
<polygon fill="#000000" stroke="#000000" points="92.7061,-189.0959 95.9952,-179.0245 87.1434,-184.8466 92.7061,-189.0959"></polygon>
</g>
<!-- d -->
<g id="node5" class="node">
<title>d</title>
<ellipse fill="none" stroke="#000000" cx="82" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="82" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- c&#45;&gt;d -->
<g id="edge5" class="edge">
<title>c-&gt;d</title>
<path fill="none" stroke="#000000" d="M102.3258,-144.2022C99.2524,-136.0064 95.5384,-126.1024 92.1305,-117.0145"></path>
<polygon fill="#000000" stroke="#000000" points="95.3858,-115.7274 88.5974,-107.593 88.8315,-118.1853 95.3858,-115.7274"></polygon>
</g>
<!-- 3 -->
<g id="node7" class="node">
<title>3</title>
<ellipse fill="none" stroke="#000000" cx="137" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="137" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">3</text>
</g>
<!-- c&#45;&gt;3 -->
<g id="edge7" class="edge">
<title>c-&gt;3</title>
<path fill="none" stroke="#000000" d="M112.4896,-144.0535C117.2683,-119.4774 125.8971,-75.1008 131.5366,-46.0974"></path>
<polygon fill="#000000" stroke="#000000" points="134.9933,-46.6569 133.4664,-36.1727 128.122,-45.3208 134.9933,-46.6569"></polygon>
</g>
<!-- * -->
<g id="node6" class="node">
<title>*</title>
<ellipse fill="none" stroke="#000000" cx="65" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="65" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">*</text>
</g>
<!-- d&#45;&gt;* -->
<g id="edge6" class="edge">
<title>d-&gt;*</title>
<path fill="none" stroke="#000000" d="M77.7978,-72.2022C75.9179,-64.2406 73.6575,-54.6671 71.5629,-45.7957"></path>
<polygon fill="#000000" stroke="#000000" points="74.9172,-44.7706 69.2128,-35.8425 68.1045,-46.3792 74.9172,-44.7706"></polygon>
</g>
<!-- d&#45;&gt;3 -->
<g id="edge8" class="edge">
<title>d-&gt;3</title>
<path fill="none" stroke="#000000" d="M94.4804,-73.6621C101.5124,-64.4564 110.4347,-52.7764 118.2883,-42.4953"></path>
<polygon fill="#000000" stroke="#000000" points="121.28,-44.3446 124.569,-34.2733 115.7172,-40.0953 121.28,-44.3446"></polygon>
</g>
</g>
</svg>

<p>We can see that both arguments to <code>+</code> point to the same sub-expression (labelled <code>y</code>) and both arguments to <code>*</code> point to the same instance of <code>3</code>. The outermost application is that of <code>+</code>, but it requires both of its arguments to be evaluated first. Both arguments are the inner application of <code>*</code>, which we can reduce. This gives us the following:</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="134pt" height="188pt" viewBox="0.00 0.00 134.00 188.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-184 130,-184 130,4 -4,4"></polygon>
<!-- a -->
<g id="node1" class="node">
<title>a</title>
<ellipse fill="none" stroke="#000000" cx="71" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="71" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- b -->
<g id="node2" class="node">
<title>b</title>
<ellipse fill="none" stroke="#000000" cx="44" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="44" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a&#45;&gt;b -->
<g id="edge1" class="edge">
<title>a-&gt;b</title>
<path fill="none" stroke="#000000" d="M64.3258,-144.2022C61.2524,-136.0064 57.5384,-126.1024 54.1305,-117.0145"></path>
<polygon fill="#000000" stroke="#000000" points="57.3858,-115.7274 50.5974,-107.593 50.8315,-118.1853 57.3858,-115.7274"></polygon>
</g>
<!-- 9 -->
<g id="node4" class="node">
<title>9</title>
<ellipse fill="none" stroke="#000000" cx="99" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">9</text>
</g>
<!-- a&#45;&gt;9 -->
<g id="edge3" class="edge">
<title>a-&gt;9</title>
<path fill="none" stroke="#000000" d="M74.4896,-144.0535C79.2683,-119.4774 87.8971,-75.1008 93.5366,-46.0974"></path>
<polygon fill="#000000" stroke="#000000" points="96.9933,-46.6569 95.4664,-36.1727 90.122,-45.3208 96.9933,-46.6569"></polygon>
</g>
<!-- + -->
<g id="node3" class="node">
<title>+</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">+</text>
</g>
<!-- b&#45;&gt;+ -->
<g id="edge2" class="edge">
<title>b-&gt;+</title>
<path fill="none" stroke="#000000" d="M39.7978,-72.2022C37.9179,-64.2406 35.6575,-54.6671 33.5629,-45.7957"></path>
<polygon fill="#000000" stroke="#000000" points="36.9172,-44.7706 31.2128,-35.8425 30.1045,-46.3792 36.9172,-44.7706"></polygon>
</g>
<!-- b&#45;&gt;9 -->
<g id="edge4" class="edge">
<title>b-&gt;9</title>
<path fill="none" stroke="#000000" d="M56.4804,-73.6621C63.5124,-64.4564 72.4347,-52.7764 80.2883,-42.4953"></path>
<polygon fill="#000000" stroke="#000000" points="83.28,-44.3446 86.569,-34.2733 77.7172,-40.0953 83.28,-44.3446"></polygon>
</g>
</g>
</svg>

<p>which reduces to</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="62pt" height="44pt" viewBox="0.00 0.00 62.00 44.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 40)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-40 58,-40 58,4 -4,4"></polygon>
<!-- 18 -->
<g id="node1" class="node">
<title>18</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">18</text>
</g>
</g>
</svg>

<h2 id="reducing-supercombinator-applications">Reducing supercombinator applications</h2>
<p>When reducing a supercombinator application, there are two things we must consider:</p>
<ol type="1">
<li>The argument may contain redexes, so we want to avoid copying it.</li>
<li>The redex may be shared, so we want to update it with its result after reduction.</li>
</ol>
<p>To do this we construct a new instance of the supercombinator body, substituting a <em>pointer</em> to the argument in place of the function parameter. This avoids having to copy the argument, which may be large. Once we’ve reduced a redex, we overwrite the root of the redex with the result of the reduction. This ensures that any other references to it will not have to reduce it again.</p>
<p>There’s one case we need to be careful of, however. Consider the following Core program:</p>
<pre><code>id x = x
main = let y = 4
        in * (id y) y</code></pre>
<p>After some reduction, the graph of this program looks like this:</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="189pt" height="260pt" viewBox="0.00 0.00 189.00 260.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 256)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-256 185,-256 185,4 -4,4"></polygon>
<!-- a1 -->
<g id="node1" class="node">
<title>a1</title>
<ellipse fill="none" stroke="#000000" cx="126" cy="-234" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="126" y="-229.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a2 -->
<g id="node2" class="node">
<title>a2</title>
<ellipse fill="none" stroke="#000000" cx="99" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a1&#45;&gt;a2 -->
<g id="edge1" class="edge">
<title>a1-&gt;a2</title>
<path fill="none" stroke="#000000" d="M119.3258,-216.2022C116.2524,-208.0064 112.5384,-198.1024 109.1305,-189.0145"></path>
<polygon fill="#000000" stroke="#000000" points="112.3858,-187.7274 105.5974,-179.593 105.8315,-190.1853 112.3858,-187.7274"></polygon>
</g>
<!-- 4 -->
<g id="node3" class="node">
<title>4</title>
<ellipse fill="none" stroke="#000000" cx="154" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="154" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">4</text>
</g>
<!-- a1&#45;&gt;4 -->
<g id="edge2" class="edge">
<title>a1-&gt;4</title>
<path fill="none" stroke="#000000" d="M129.2182,-216.0337C131.0409,-205.5449 133.2909,-192.0449 135,-180 141.6479,-133.1476 147.7128,-78.4332 151.1231,-46.0852"></path>
<polygon fill="#000000" stroke="#000000" points="154.6169,-46.3257 152.1748,-36.0161 147.6548,-45.5984 154.6169,-46.3257"></polygon>
</g>
<!-- * -->
<g id="node4" class="node">
<title>*</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">*</text>
</g>
<!-- a2&#45;&gt;* -->
<g id="edge3" class="edge">
<title>a2-&gt;*</title>
<path fill="none" stroke="#000000" d="M83.7307,-146.7307C73.803,-136.803 60.6847,-123.6847 49.5637,-112.5637"></path>
<polygon fill="#000000" stroke="#000000" points="51.7933,-109.8436 42.2473,-105.2473 46.8436,-114.7933 51.7933,-109.8436"></polygon>
</g>
<!-- y -->
<g id="node5" class="node">
<title>y</title>
<ellipse fill="none" stroke="#000000" cx="99" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a2&#45;&gt;y -->
<g id="edge6" class="edge">
<title>a2-&gt;y</title>
<path fill="none" stroke="#000000" d="M99,-143.8314C99,-136.131 99,-126.9743 99,-118.4166"></path>
<polygon fill="#000000" stroke="#000000" points="102.5001,-118.4132 99,-108.4133 95.5001,-118.4133 102.5001,-118.4132"></polygon>
</g>
<!-- y&#45;&gt;4 -->
<g id="edge5" class="edge">
<title>y-&gt;4</title>
<path fill="none" stroke="#000000" d="M111.4804,-73.6621C118.5124,-64.4564 127.4347,-52.7764 135.2883,-42.4953"></path>
<polygon fill="#000000" stroke="#000000" points="138.28,-44.3446 141.569,-34.2733 132.7172,-40.0953 138.28,-44.3446"></polygon>
</g>
<!-- id -->
<g id="node6" class="node">
<title>id</title>
<ellipse fill="none" stroke="#000000" cx="82" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="82" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">id</text>
</g>
<!-- y&#45;&gt;id -->
<g id="edge4" class="edge">
<title>y-&gt;id</title>
<path fill="none" stroke="#000000" d="M94.7978,-72.2022C92.9179,-64.2406 90.6575,-54.6671 88.5629,-45.7957"></path>
<polygon fill="#000000" stroke="#000000" points="91.9172,-44.7706 86.2128,-35.8425 85.1045,-46.3792 91.9172,-44.7706"></polygon>
</g>
</g>
</svg>

<p>Let’s consider the reduction of <code>(id 4)</code>. If we were to naively update the root of the redex with the result, we’d end up with the following.</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="170pt" height="188pt" viewBox="0.00 0.00 170.00 188.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-184 166,-184 166,4 -4,4"></polygon>
<!-- a1 -->
<g id="node1" class="node">
<title>a1</title>
<ellipse fill="none" stroke="#000000" cx="99" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a2 -->
<g id="node2" class="node">
<title>a2</title>
<ellipse fill="none" stroke="#000000" cx="63" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="63" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a1&#45;&gt;a2 -->
<g id="edge1" class="edge">
<title>a1-&gt;a2</title>
<path fill="none" stroke="#000000" d="M90.2854,-144.5708C86.0403,-136.0807 80.8464,-125.6929 76.1337,-116.2674"></path>
<polygon fill="#000000" stroke="#000000" points="79.237,-114.6477 71.6343,-107.2687 72.976,-117.7782 79.237,-114.6477"></polygon>
</g>
<!-- 4 -->
<g id="node3" class="node">
<title>4</title>
<ellipse fill="none" stroke="#000000" cx="135" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="135" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">4</text>
</g>
<!-- a1&#45;&gt;4 -->
<g id="edge2" class="edge">
<title>a1-&gt;4</title>
<path fill="none" stroke="#000000" d="M107.7146,-144.5708C111.9597,-136.0807 117.1536,-125.6929 121.8663,-116.2674"></path>
<polygon fill="#000000" stroke="#000000" points="125.024,-117.7782 126.3657,-107.2687 118.763,-114.6477 125.024,-117.7782"></polygon>
</g>
<!-- * -->
<g id="node4" class="node">
<title>*</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">*</text>
</g>
<!-- a2&#45;&gt;* -->
<g id="edge3" class="edge">
<title>a2-&gt;*</title>
<path fill="none" stroke="#000000" d="M54.2854,-72.5708C50.0403,-64.0807 44.8464,-53.6929 40.1337,-44.2674"></path>
<polygon fill="#000000" stroke="#000000" points="43.237,-42.6477 35.6343,-35.2687 36.976,-45.7782 43.237,-42.6477"></polygon>
</g>
<!-- z -->
<g id="node5" class="node">
<title>z</title>
<ellipse fill="none" stroke="#000000" cx="99" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">4</text>
</g>
<!-- a2&#45;&gt;z -->
<g id="edge4" class="edge">
<title>a2-&gt;z</title>
<path fill="none" stroke="#000000" d="M71.7146,-72.5708C75.9597,-64.0807 81.1536,-53.6929 85.8663,-44.2674"></path>
<polygon fill="#000000" stroke="#000000" points="89.024,-45.7782 90.3657,-35.2687 82.763,-42.6477 89.024,-45.7782"></polygon>
</g>
</g>
</svg>

<p>We’ve duplicated <code>4</code>! If this was a large expression, we would be at risk of doing extra work reducing it twice. To get around this, we can add a new type of node: an <em>indirection node</em>. This node simply points to another node, and we can use it to update the root of the redex without duplicating the result. Using an indirection node (marked by a <code>#</code>) we get the following:</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="161pt" height="260pt" viewBox="0.00 0.00 161.00 260.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 256)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-256 157,-256 157,4 -4,4"></polygon>
<!-- a1 -->
<g id="node1" class="node">
<title>a1</title>
<ellipse fill="none" stroke="#000000" cx="126" cy="-234" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="126" y="-229.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a2 -->
<g id="node2" class="node">
<title>a2</title>
<ellipse fill="none" stroke="#000000" cx="99" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-157.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">@</text>
</g>
<!-- a1&#45;&gt;a2 -->
<g id="edge1" class="edge">
<title>a1-&gt;a2</title>
<path fill="none" stroke="#000000" d="M119.3258,-216.2022C116.2524,-208.0064 112.5384,-198.1024 109.1305,-189.0145"></path>
<polygon fill="#000000" stroke="#000000" points="112.3858,-187.7274 105.5974,-179.593 105.8315,-190.1853 112.3858,-187.7274"></polygon>
</g>
<!-- 4 -->
<g id="node3" class="node">
<title>4</title>
<ellipse fill="none" stroke="#000000" cx="126" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="126" y="-13.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">4</text>
</g>
<!-- a1&#45;&gt;4 -->
<g id="edge2" class="edge">
<title>a1-&gt;4</title>
<path fill="none" stroke="#000000" d="M129.7474,-216.0931C131.7466,-205.6241 133.9966,-192.1241 135,-180 138.9591,-132.1636 138.9591,-119.8364 135,-72 134.2945,-63.4753 132.9727,-54.2703 131.5551,-45.917"></path>
<polygon fill="#000000" stroke="#000000" points="134.9689,-45.1258 129.7474,-35.9069 128.0803,-46.3698 134.9689,-45.1258"></polygon>
</g>
<!-- * -->
<g id="node4" class="node">
<title>*</title>
<ellipse fill="none" stroke="#000000" cx="27" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">*</text>
</g>
<!-- a2&#45;&gt;* -->
<g id="edge3" class="edge">
<title>a2-&gt;*</title>
<path fill="none" stroke="#000000" d="M83.7307,-146.7307C73.803,-136.803 60.6847,-123.6847 49.5637,-112.5637"></path>
<polygon fill="#000000" stroke="#000000" points="51.7933,-109.8436 42.2473,-105.2473 46.8436,-114.7933 51.7933,-109.8436"></polygon>
</g>
<!-- ind -->
<g id="node5" class="node">
<title>ind</title>
<ellipse fill="none" stroke="#000000" cx="99" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-85.8" font-family="Courier,monospace" font-size="14.00" fill="#000000">#</text>
</g>
<!-- a2&#45;&gt;ind -->
<g id="edge5" class="edge">
<title>a2-&gt;ind</title>
<path fill="none" stroke="#000000" d="M99,-143.8314C99,-136.131 99,-126.9743 99,-118.4166"></path>
<polygon fill="#000000" stroke="#000000" points="102.5001,-118.4132 99,-108.4133 95.5001,-118.4133 102.5001,-118.4132"></polygon>
</g>
<!-- ind&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>ind-&gt;4</title>
<path fill="none" stroke="#000000" d="M105.6742,-72.2022C108.7476,-64.0064 112.4616,-54.1024 115.8695,-45.0145"></path>
<polygon fill="#000000" stroke="#000000" points="119.1685,-46.1853 119.4026,-35.593 112.6142,-43.7274 119.1685,-46.1853"></polygon>
</g>
</g>
</svg>

<p>We can then reduce this in the normal way. When we encounter an indirection node we simply skip over it and look at its target. In one step this reduces to <code>16</code>.</p>
<p>Those are the basics of graph reduction. In the next section we’ll apply this theory to our first compiler: the template instantiation machine.</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>In this case we could call it a tree, but trees are just a specific type of graph. Later on we’ll see that certain transformations on the tree will make it no longer a valid tree. So for simplicity we’ll refer to everything as a graph.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</section>
  </body>
</html>
